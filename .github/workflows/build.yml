#
# .github/workflows/build-on-windows.yml
#
# Copyright 2021 Jens A. Koch.
# SPDX-License-Identifier: BSL-1.0
# This file is part of https://github.com/jakoch/wikifolio_universe.
#

name: "Build"

on:
  schedule:
    # Daily at 08:00.
    - cron: '0 9 * * *'
  push:
  pull_request:
  # You can manually run this workflow.
  workflow_dispatch:

jobs:

# ---------------------------------------------------------------------------------------

  build:

# ---------------------------------------------------------------------------------------

    name: "Build"
    runs-on: ubuntu-latest

    steps:
    - name: Checkout main branch
      uses: actions/checkout@v3

    - name: Checkout gh-pages branch into data folder
      uses: actions/checkout@v3
      with:
        ref: gh-pages
        path: data
        fetch-depth: 1

    - name: âœ‚ Cleanup data folder before generating new content
      run: |
        cd data
        rm -rf README.md wiuc sqlite/*.sqlite.zip csv/*.csv.zip
        ls

    - name: ðŸ”½ Install
      run: |
        chmod +x ./convert.sh
        . ./convert.sh && run
        
    - name: âœ— Pre-Commit Cleanup
      run: |
        cd data
        rm -rf wiuc
        ls

    - name: âœ” Commit
      run: |
        cd data
        git add -A
        git config --local user.email "github-actions[bot]@users.noreply.jakoch.wikifolio_universe.org"
        git config --local user.name "github-actions[bot]"
        git commit -m "Publish docs from ${GITHUB_REPOSITORY}@${GITHUB_SHA:0:9}"

    - name: ðŸš€ Push to gh-pages branch
      run: git push --force origin gh-pages
