#
# .github/workflows/build-on-windows.yml
#
# Copyright 2021 Jens A. Koch.
# SPDX-License-Identifier: BSL-1.0
# This file is part of https://github.com/jakoch/wikifolio_universe.
#

name: "Build"

on:  
  schedule: 
    # Daily at 08:00.
    - cron: '0 8 * * *' 
  push:
  pull_request:

jobs:

# ---------------------------------------------------------------------------------------

  build:

# ---------------------------------------------------------------------------------------
    
    name: "Build"
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v2
      
    - name: Convert
      run: |
        chmod +x ./convert.sh 
        ./convert.sh 
    
    # Delete all files, which should not be published on the website branch.
    - name: âœ— Pre-Commit Cleanup
      run: |
        rm .gitignore .travis.yml publish.sh
        rm -rf .git .github query
        ls
          
    # Re-initialize the cleaned repo and commit it.
    - name: âœ” Commit
      run: |
        git init
        git add -A
        git config --local user.email "github-actions[bot]@users.noreply.jakoch.wikifolio_universe.org"
        git config --local user.name "github-actions[bot]"
        git commit -m "Publish docs from ${GITHUB_REPOSITORY}@${GITHUB_SHA:0:9}"
          
    # Push the repo to the gh-pages branch.
    - name: ðŸš€ Push
      uses: ad-m/github-push-action@v0.6.0 # https://github.com/ad-m/github-push-action
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: gh-pages
        directory: ${{ env.GITHUB_WORKSPACE }}
        force: true
